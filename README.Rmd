<!-- This is the README file of the Getting and Cleaning Data Course Project -->

---
title: "README"
author: "CHI YEUNG WONG"
date: "2020-11-08"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Getting and Cleaning Data Course Project

## Purpose

The purpose of this project is used to demonstrate the ability to collect,
work with and clean data set. The goal is to prepare a new tidy data set that
can be used for later analysis.


## Data Source

Data to be used are collected from the accelerometers of the SamSung
Galaxy S smartphones which is provided from the course website as shown below:

<https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip>


## Project Details

In order to complete this project, it is asked to

    1. Merges the training and the test sets to create a one data set.
    2. Extracts only the measurements on the mean and standard deviation of 
       each measurement.
    3. Uses descriptive activity names to name the activities in the data set.
    4. Appropriately labels the data set with descriptive variable names.
    5. From the data set in step 4, creates a second, independent tidy data set 
       with the average of each variable for each activity and each subject.
    
The tasks mentioned above will be implemented in a program file **run_analysis.R**
and the new tidy dataset will be saved in a data file **tidy_data.txt**.

    
### Data Prepration

Before we could perform any analysis, corresponding datasets will be downloaded
from the course website as shown below:

```{r data_download}
data.url <- "https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip"
download.file(data.url, destfile = "./data/Dataset.zip", method = "curl")
unzip(zipfile = "./data/Dataset.zip", exdir = "./data")
```

Dataset will be downloaded to the folder **Data** and is unzip.

According to the **README.txt** from the dataset, it is found that below data files 
will be used:

    * feature.txt:           List of all features
    * activity_labels.txt:   Activity names
    * train/X_train.txt:     Training dataset of features
    * train/y_train.txt:     Training dataset of activities
    * train/subject_train:   Training dataset of subjects
    * test/X_test.txt:       Test dataset of features
    * test/y_test.txt:       Test dataset of activities
    * test/subject_test.txt: Test dataset of subjects
    
All data files will be read and assigned to corresponding variables as show below:

```{r read_data}

# Reading training Data
train.subject <- read.table("data/UCI HAR Dataset/train/subject_train.txt", header = FALSE)
train.activity <- read.table("data/UCI HAR Dataset/train/y_train.txt", header = FALSE)
train.features <- read.table("data/UCI HAR Dataset/train/X_train.txt", header = FALSE)

# Reading test Data
test.subject <- read.table("data/UCI HAR Dataset/test/subject_test.txt", header = FALSE)
test.activity <- read.table("data/UCI HAR Dataset/test/y_test.txt", header = FALSE)
test.features <- read.table("data/UCI HAR Dataset/test/X_test.txt", header = FALSE)

```

Training dataset of subject is:
```{r train_subject_dataset}
str(train.subject)
```

Training dataset of activity is:
```{r train_activity_dataset}
str(train.activity)
```

Training dataset of features is:
```{r train_features_dataset}
str(train.features)
```

Test dataset of subject is:
```{r test_subject_dataset}
str(test.subject)
```

Test dataset of activity is:
```{r test_activity_dataset}
str(test.activity)
```

Test dataset of features is:
```{r test_features_dataset}
str(test.features)
```

### Merges the Training and the Test Sets to Create One Dataset

In order to merge all data into one dataset, training and test datasets will be 
first *rbind* according to subject, activity and features. Corresponding columns 
will be renamed to more descriptive names. Column names of the dataset of features
will be based on the **features.txt**. All *rbind* datasets will be *cbind* to
one dataset.

Datasets merging will be implemented as shown below:

```{r merge_datasets}

# Merge training and test data sets for subject
data.subject <- rbind(train.subject, test.subject)

# Rename the column name of subject data set to "Subject"
colnames(data.subject) <- "Subject"

# Merge training and test data sets for activity
data.activity <- rbind(train.activity, test.activity)

# Rename the column name of activity data set to "Activity"
colnames(data.activity) <- "Activity"

# Merge training and test data sets for features
data.features <- rbind(train.features, test.features)

# Rename the column names of features data set according to "features.txt"
colnames.features <- read.table("data/UCI HAR Dataset/features.txt", header = FALSE)
colnames(data.features) <- t(colnames.features[2])

# Merge subject, activity and features data sets into in data set 
# and store in "complete.data"
data.all <- cbind(data.subject, data.activity, data.features)

# Show the merged dataset
str(data.all)

```

### Extracts Only the Measurements on the Mean and Standard Deviation

Dataset with only Mean and Standard Deviation will be extracted by using *grep*
as shown below:

```{r extract_mean_and_sd}

colMeanSD <- grep(".*Mean.*|.*Std.*", names(data.all), ignore.case = TRUE)
data.Extracted <- subset(data.all, select = c(1, 2, colMeanSD))

# Show the extracted columns
names(data.Extracted)

```

### Uses Descriptive Activity Names in the Dataset

In order to assign descriptive activity names to the dataset, corresponding
activity names are needed to extract from **activity_labels.txt** as shown below:

```{r read_activity_labels}

label.activity <- read.table("data/UCI HAR Dataset/activity_labels.txt", header = FALSE)

# Show the labels
label.activity

```

Then, activity will be labeled according to the activity values in the
dataset as shown below:

```{r assign_activity_labels}

for(i in 1:6) {
    data.Extracted$Activity[data.Extracted$Activity==i] <- as.character(label.activity[i,2])}

```

The first 50 activties from the dataset after renamed are as follows:

```{r 1st_50_activities}
head(data.Extracted$Activity, 50)
```

### Appropriately Labels the Dataset with Descriptive Variable Names

It is recommended to rename the variable names as shown below:

| Abbreviation | To Be Used/Replaced |
|--------------|---------------------|
| "t"          | "Time"              |
| "f"          | "Frequency"         |
| "Acc"        | "Accelerometer"     |
| "Gyro"       | "Gyroscope"         |
| "BodyBody"   | "Body"              |
| "Mag"        | "Magnitude"         |
| "angle"      | "Angle"             |
| "gravity"    | "Gravity"           |
| "-mean()"    | "Mean"              |
| "-std()"     | "STD"               |
| "-freq()"    | "Frequency"         |

The abbreviation will be pattern matched and replaced by using *gsub* in the dataset.

```{r rename_the variables}

names(data.Extracted) <- gsub("^t", "Time", names(data.Extracted))
names(data.Extracted) <- gsub("^f", "Frequency", names(data.Extracted))
names(data.Extracted) <- gsub("Acc", "Accelerometer", names(data.Extracted))
names(data.Extracted) <- gsub("Gyro", "Gyroscope", names(data.Extracted))
names(data.Extracted) <- gsub("BodyBody", "Body", names(data.Extracted))
names(data.Extracted) <- gsub("Mag", "Magnitude", names(data.Extracted))
names(data.Extracted) <- gsub("angle", "Angle", names(data.Extracted))
names(data.Extracted) <- gsub("gravity", "Gravity", names(data.Extracted))
names(data.Extracted) <- gsub("-mean()", "Mean", names(data.Extracted), ignore.case = TRUE)
names(data.Extracted) <- gsub("-std()", "STD", names(data.Extracted), ignore.case = TRUE)
names(data.Extracted) <- gsub("-freq()", "Frequency", names(data.Extracted), ignore.case = TRUE)

```

The result is as shown below:

```{r show_rename_result}

names(data.Extracted)

```


## Create a Second, Independent Tidy Dataset with the Average of Each Variable for Each Activity and Each Subject

The varaible *Subject* in the dataset will be factorized first. Then, the *mean* 
of each variable for each subject and activity will be computed by using
*aggregate*. The new tidy dataset will be stored in a new variable, *data.New*
and will be saved in a new data file **tidy_data.txt**.

```{r create_new_dataset}

# set "Subject" as the factor variable
data.Extracted$Subject <- as.factor(data.Extracted$Subject)

# calculate the average for each subject and activity
data.New <- aggregate(. ~Subject + Activity, data.Extracted, mean)
data.New <- data.New[order(data.New$Subject, data.New$Activity),]

# create a new data set file
write.table(data.New, file = "tidy_data.txt", row.names = FALSE)

```

The new tidy dataset to be saved is shown as follows:

```{r show_new_data}

str(data.New)

```
